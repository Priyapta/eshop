<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Order Payment</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .payment-details {
            display: none;
            margin-top: 15px;
        }
        .card {
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
        }
        .card-header {
            background-color: #007bff !important;
            color: white !important;
            font-weight: bold;
        }
        .btn-primary {
            width: 100%;
            padding: 12px;
            font-size: 1.2rem;
            font-weight: bold;
        }
    </style>
</head>
<body>
<div class="container my-4">
    <h2>Order Payment</h2>
    <div class="card">
        <div class="card-header">Order Details</div>
        <div class="card-body">
            <p>Order ID: <span th:text="${order.id}"></span></p>
            <p>Author: <span th:text="${order.author}"></span></p>
            <p>Order Time: <span th:text="${#dates.format(order.orderTime, 'yyyy-MM-dd HH:mm:ss')}"></span></p>
            <h4>Products</h4>
            <table class="table">
                <thead>
                <tr>
                    <th>Product Name</th>
                    <th>Quantity</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="product : ${order.products}">
                    <td th:text="${product.productName}"></td>
                    <td th:text="${product.productQuantity}"></td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <form th:action="@{/order/pay/{orderId}(orderId=${order.id})}" method="post" class="mt-3" id="paymentForm">
        <div class="form-group">
            <label>Payment Method</label>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="paymentMethod" id="voucher" value="VOUCHER" required>
                <label class="form-check-label" for="voucher">Voucher</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="paymentMethod" id="bank" value="BANK" required>
                <label class="form-check-label" for="bank">Bank Transfer</label>
            </div>
        </div>

        <div id="voucherDetails" class="payment-details">
            <div class="form-group">
                <label for="voucherCode">Voucher Code</label>
                <input type="text" class="form-control" id="voucherCode" name="voucherCode" placeholder="Enter 16-digit voucher code" required>
                <small class="form-text text-muted">
                    Voucher code must:
                    <ul>
                        <li>Start with 'ESHOP'</li>
                        <li>Be exactly 16 characters long</li>
                        <li>Contain 8 digits</li>
                    </ul>
                </small>
            </div>
            <div id="voucherValidation" class="alert" style="display: none;"></div>
        </div>

        <div id="bankDetails" class="payment-details">
            <div class="form-group">
                <label for="bankName">Bank Name</label>
                <input type="text" class="form-control" id="bankName" name="bankName" placeholder="Enter bank name" required>
            </div>
            <div class="form-group">
                <label for="referenceCode">Reference Code</label>
                <input type="text" class="form-control" id="referenceCode" name="referenceCode" placeholder="Enter reference code" required>
            </div>
        </div>

        <button type="submit" class="btn btn-primary" id="submitPayment" disabled>Process Payment</button>
    </form>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const paymentForm = document.getElementById('paymentForm');
        const voucherRadio = document.getElementById('voucher');
        const bankRadio = document.getElementById('bank');
        const voucherDetails = document.getElementById('voucherDetails');
        const bankDetails = document.getElementById('bankDetails');
        const voucherCode = document.getElementById('voucherCode');
        const bankName = document.getElementById('bankName');
        const referenceCode = document.getElementById('referenceCode');
        const voucherValidation = document.getElementById('voucherValidation');
        const submitPayment = document.getElementById('submitPayment');



        function togglePaymentDetails() {
            if (voucherRadio.checked) {
                voucherDetails.style.display = 'block';
                bankDetails.style.display = 'none';
                validateVoucherCode();
            } else if (bankRadio.checked) {
                voucherDetails.style.display = 'none';
                bankDetails.style.display = 'block';
                validateBankDetails();
            }
        }

        function validateVoucherCode() {
            const code = voucherCode.value;
            const isValid = code.startsWith('ESHOP') &&
                code.length === 16 &&
                (code.match(/\d/g) || []).length === 8;

            voucherValidation.style.display = 'block';
            if (isValid) {
                voucherValidation.className = 'alert alert-success';
                voucherValidation.textContent = 'Valid voucher code!';
                submitPayment.disabled = false;
            } else {
                voucherValidation.className = 'alert alert-danger';
                voucherValidation.textContent = 'Invalid voucher code. Please check the requirements.';
                submitPayment.disabled = true;
            }
        }

        function validateBankDetails() {
            const nameValue = bankName.value.trim();
            const refValue = referenceCode.value.trim();

            const isValid = nameValue.length > 0 && refValue.length > 0;
            submitPayment.disabled = !isValid;
        }

        voucherRadio.addEventListener('change', togglePaymentDetails);
        bankRadio.addEventListener('change', togglePaymentDetails);
        voucherCode.addEventListener('input', validateVoucherCode);
        bankName.addEventListener('input', validateBankDetails);
        referenceCode.addEventListener('input', validateBankDetails);

        togglePaymentDetails();
    });
</script>
</body>
</html>
